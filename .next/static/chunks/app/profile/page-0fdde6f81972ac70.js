(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},6203:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5155),n=r(2115),s=r(5695),o=r(8508);let l="http://localhost:8000/api";async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=(0,o.iD)();if(!a)throw Error("Not authenticated");let n={...t.headers||{},Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},s=await fetch(e,{...t,headers:n});if(401===s.status&&r){let r=(0,o.ve)();if(!r)throw Error("Session expired. Please login again.");let a=await fetch("".concat(l,"/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:r})});if(!a.ok)throw(0,o.ri)(),Error("Session expired. Please login again.");let n=await a.json();return localStorage.setItem("access_token",n.access),i(e,t,!1)}if(!s.ok){let e="Error";try{let t=await s.json();e=t.detail||Object.values(t).join(" ")}catch(e){}throw Error(e)}return s.json()}async function c(){return i("".concat(l,"/me/"))}async function u(e){return i("".concat(l,"/me/"),{method:"PATCH",body:JSON.stringify(e)})}function d(){let[e,t]=(0,n.useState)(null),[r,l]=(0,n.useState)({}),[i,d]=(0,n.useState)(!0),[m,h]=(0,n.useState)(!1),[f,g]=(0,n.useState)(null),[p,x]=(0,n.useState)(null),b=(0,s.useRouter)();(0,n.useEffect)(()=>{if(!(0,o.wR)())return void b.replace("/login");d(!0),c().then(e=>{t(e),l({username:e.username,first_name:e.first_name,last_name:e.last_name,telephone:e.telephone,cni:e.cni}),d(!1)}).catch(e=>{g(e.message||"Erreur de chargement du profil"),d(!1)})},[b]);let y=e=>{l({...r,[e.target.name]:e.target.value})},w=async a=>{a.preventDefault(),h(!0),g(null),x(null);try{await u(r),t({...e,...r}),x("Profil mis \xe0 jour avec succ\xe8s !")}catch(e){e instanceof Error?g(e.message):g("Erreur lors de la mise \xe0 jour")}finally{h(!1)}};return i?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-tr from-blue-100 via-white to-blue-200",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-10 w-10 text-blue-600 mb-4",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),(0,a.jsx)("span",{className:"text-gray-700",children:"Chargement du profil..."})]})}):(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-tr from-blue-100 via-white to-blue-200 px-2",children:(0,a.jsxs)("form",{onSubmit:w,className:"bg-white bg-opacity-95 p-8 rounded-2xl shadow-xl w-full max-w-md space-y-5 border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-2",children:[(0,a.jsx)("span",{className:"inline-flex items-center justify-center w-14 h-14 rounded-full bg-blue-100 mb-2",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Zm2 6a6 6 0 0 0-12 0"})})}),(0,a.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 text-center tracking-tight",children:"Mon profil"})]}),f&&(0,a.jsx)("div",{className:"text-red-500 text-center font-medium",children:f}),p&&(0,a.jsx)("div",{className:"text-green-600 text-center font-medium",children:p}),(0,a.jsx)("input",{name:"email",value:(null==e?void 0:e.email)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-lg bg-gray-100 text-gray-500"}),(0,a.jsx)("input",{name:"username",value:r.username||"",onChange:y,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-gray-900 placeholder-gray-400 transition-shadow shadow-sm focus:shadow-md",placeholder:"Nom d'utilisateur"}),(0,a.jsx)("input",{name:"first_name",value:r.first_name||"",onChange:y,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-gray-900 placeholder-gray-400 transition-shadow shadow-sm focus:shadow-md",placeholder:"Pr\xe9nom"}),(0,a.jsx)("input",{name:"last_name",value:r.last_name||"",onChange:y,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-gray-900 placeholder-gray-400 transition-shadow shadow-sm focus:shadow-md",placeholder:"Nom"}),(0,a.jsx)("input",{name:"telephone",value:r.telephone||"",onChange:y,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-gray-900 placeholder-gray-400 transition-shadow shadow-sm focus:shadow-md",placeholder:"T\xe9l\xe9phone"}),(0,a.jsx)("input",{name:"cni",value:r.cni||"",onChange:y,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-gray-900 placeholder-gray-400 transition-shadow shadow-sm focus:shadow-md",placeholder:"CNI"}),(0,a.jsx)("input",{name:"role",value:(null==e?void 0:e.role)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-lg bg-gray-100 text-gray-500"}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-500 to-blue-700 text-white font-semibold py-2 rounded-lg shadow hover:from-blue-600 hover:to-blue-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400",disabled:m,children:m?"Enregistrement...":"Enregistrer"})]})})}},7923:(e,t,r)=>{Promise.resolve().then(r.bind(r,6203))},8508:(e,t,r)=>{"use strict";r.d(t,{J3:()=>l,Lx:()=>n,iD:()=>s,ri:()=>c,ve:()=>o,wR:()=>i});let a={getItem:e=>localStorage.getItem(e),setItem:(e,t)=>{localStorage.setItem(e,t)},removeItem:e=>{localStorage.removeItem(e)}};async function n(e,t){let r=await fetch("http://localhost:8000/api/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){let e="Identifiants invalides";try{let t=await r.json();e=t.detail||Object.values(t).join(" ")}catch(e){}throw Error(e)}let n=await r.json();a.setItem("access_token",n.access),a.setItem("refresh_token",n.refresh);let s=null;try{(s=JSON.parse(atob(n.access.split(".")[1])))&&s.username&&a.setItem("username",s.username),s&&s.first_name&&a.setItem("first_name",s.first_name)}catch(e){}return s}function s(){return a.getItem("access_token")}function o(){return a.getItem("refresh_token")}function l(){return a.getItem("first_name")||a.getItem("username")||""}function i(){return!!s()}function c(){a.removeItem("access_token"),a.removeItem("refresh_token"),a.removeItem("username"),a.removeItem("first_name")}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(7923)),_N_E=e.O()}]);