(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[969],{1777:(e,t,s)=>{"use strict";s.d(t,{R0:()=>i,Tx:()=>c,i:()=>o,oK:()=>l,vA:()=>d});var r=s(8508);let a="http://localhost:8000/api";async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=(0,r.iD)();if(!i)throw Error("Not authenticated");let o={...t.headers||{},Authorization:"Bearer ".concat(i),"Content-Type":"application/json"},l=await fetch(e,{...t,headers:o});if(401===l.status&&s){let s=(0,r.ve)();if(!s)throw Error("Session expired. Please login again.");let i=await fetch("".concat(a,"/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:s})});if(!i.ok)throw(0,r.ri)(),Error("Session expired. Please login again.");let o=await i.json();return localStorage.setItem("access_token",o.access),n(e,t,!1)}if(!l.ok){let e="Error";try{let t=await l.json();e=t.detail||Object.values(t).join(" ")}catch(e){}throw Error(e)}if(204!==l.status)return l.json()}async function i(){let e=await n("".concat(a,"/maisons/"));return Array.isArray(e)?e:e&&Array.isArray(e.results)?e.results:[]}async function o(e){return n("".concat(a,"/maisons/").concat(e,"/"))}async function l(e){return n("".concat(a,"/maisons/"),{method:"POST",body:JSON.stringify(e)})}async function c(e){return n("".concat(a,"/maisons/").concat(e,"/"),{method:"DELETE"})}async function d(e,t){return n("".concat(a,"/maisons/").concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},5983:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(5155),a=s(2115),n=s(5695),i=s(1777),o=s(9053);function l(e){let{latitude:t,longitude:s,adresse:n,maisons:i,className:o=""}=e,l=(0,a.useRef)(null),[c,d]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{if(!l.current)return;let e=l.current;if(e.innerHTML="",d(!1),i&&i.length>0){let t=i.map(e=>parseFloat(e.latitude)).filter(e=>!isNaN(e)),s=i.map(e=>parseFloat(e.longitude)).filter(e=>!isNaN(e));if(t.length>0&&s.length>0){let r=Math.min(...t),a=Math.max(...t),n=Math.min(...s),i=Math.max(...s),o=Math.max((a-r)*.1,.01),l=Math.max((i-n)*.1,.01),c="".concat(n-l,",").concat(r-o,",").concat(i+l,",").concat(a+o),m=document.createElement("iframe");m.src="https://www.openstreetmap.org/export/embed.html?bbox=".concat(c,"&layer=mapnik"),m.width="100%",m.height="100%",m.setAttribute("frameborder","0"),m.setAttribute("scrolling","no"),m.style.border="none",m.title="Carte des maisons",m.onload=()=>d(!0),e.appendChild(m)}}else if(t&&s){let r=parseFloat(t),a=parseFloat(s);if(!isNaN(r)&&!isNaN(a)){let t=document.createElement("iframe");t.src="https://www.openstreetmap.org/export/embed.html?bbox=".concat(a-.005,",").concat(r-.005,",").concat(a+.005,",").concat(r+.005,"&layer=mapnik&marker=").concat(r,",").concat(a),t.width="100%",t.height="100%",t.setAttribute("frameborder","0"),t.setAttribute("scrolling","no"),t.style.border="none",t.title=n||"Carte",t.onload=()=>d(!0),e.appendChild(t)}}return()=>{e&&(e.innerHTML="")}},[t,s,n,i]),i&&i.length>0||t&&s)?(0,r.jsxs)("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 ".concat(o),children:[!c&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center z-10",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin w-6 h-6 mx-auto mb-2",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),(0,r.jsx)("p",{className:"text-xs",children:"Chargement de la carte..."})]})}),(0,r.jsx)("div",{ref:l,className:"w-full h-full"}),n&&t&&s&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-white bg-opacity-95 backdrop-blur-sm p-2 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("p",{className:"text-xs font-medium text-gray-900 truncate",title:n,children:["\uD83D\uDCCD ",n]}),(0,r.jsxs)("div",{className:"flex gap-2 text-xs text-gray-500",children:[(0,r.jsxs)("span",{children:["Lat: ",parseFloat(t).toFixed(4)]}),(0,r.jsxs)("span",{children:["Lng: ",parseFloat(s).toFixed(4)]})]})]}),(0,r.jsx)("a",{href:"https://www.openstreetmap.org/?mlat=".concat(t,"&mlon=").concat(s,"&zoom=15"),target:"_blank",rel:"noopener noreferrer",className:"ml-2 p-1 text-blue-600 hover:bg-blue-100 rounded transition",title:"Ouvrir dans OpenStreetMap",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})})]}):(0,r.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center h-full ".concat(o),children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[(0,r.jsxs)("svg",{className:"w-8 h-8 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,r.jsx)("p",{className:"text-xs",children:"Aucune carte disponible"})]})})}function c(){let[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),[m,u]=(0,a.useState)(null),[h,x]=(0,a.useState)(null),p=(0,n.useRouter)(),f=(0,n.useSearchParams)(),g=async()=>{o(!0),d(null);try{let e=await (0,i.R0)();console.log("Maisons API response:",e),t(Array.isArray(e)?e:[])}catch(e){d(e instanceof Error?e.message:"Erreur de chargement des maisons")}finally{o(!1)}};(0,a.useEffect)(()=>{g()},[]),(0,a.useEffect)(()=>{let e=f.get("success");"created"===e?(u("Maison cr\xe9\xe9e avec succ\xe8s !"),p.replace("/maisons",{scroll:!1})):"updated"===e&&(u("Maison modifi\xe9e avec succ\xe8s !"),p.replace("/maisons",{scroll:!1}))},[f,p]);let j=async s=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette maison ?")){x(s),d(null),u(null);try{await (0,i.Tx)(s),t(e.filter(e=>e.id!==s)),u("Maison supprim\xe9e avec succ\xe8s !")}catch(e){d(e instanceof Error?e.message:"Erreur lors de la suppression")}finally{x(null)}}},v=e=>{p.push("/maisons/editer?id=".concat(e))};return s?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-tr from-blue-100 via-white to-blue-200",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin h-10 w-10 text-blue-600 mb-4",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),(0,r.jsx)("span",{className:"text-gray-700",children:"Chargement des maisons..."})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-tr from-blue-100 via-white to-blue-200",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsx)("div",{className:"bg-white bg-opacity-95 rounded-2xl shadow-xl p-6 mb-8 border border-gray-100",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 mb-2",children:"Mes Maisons"}),(0,r.jsx)("p",{className:"text-gray-600",children:"G\xe9rez vos propri\xe9t\xe9s immobili\xe8res"})]}),(0,r.jsxs)("a",{href:"/maisons/ajouter",className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-6 py-3 rounded-lg shadow-lg hover:from-blue-600 hover:to-blue-800 transition-all duration-200 font-semibold flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Ajouter une maison"]})]})}),c&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),c]})}),m&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),m]})}),(0,r.jsx)("div",{className:"bg-white bg-opacity-95 rounded-2xl shadow-xl p-6 border border-gray-100",children:Array.isArray(e)&&0===e.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Aucune maison trouv\xe9e"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Commencez par ajouter votre premi\xe8re propri\xe9t\xe9"}),(0,r.jsx)("a",{href:"/maisons/ajouter",className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition",children:"Ajouter ma premi\xe8re maison"})]}):(0,r.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Array.isArray(e)&&e.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-2",children:e.adresse}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>v(e.id),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition",title:"Modifier",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,r.jsx)("button",{onClick:()=>j(e.id),disabled:h===e.id,className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition disabled:opacity-50",title:"Supprimer",children:h===e.id?(0,r.jsxs)("svg",{className:"animate-spin w-4 h-4",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}):(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("div",{className:"h-48 rounded-lg overflow-hidden border border-gray-200",children:(0,r.jsx)(l,{latitude:e.latitude,longitude:e.longitude,adresse:e.adresse,className:"h-full"})})}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:e.description}),(0,r.jsx)("div",{className:"flex justify-end items-center text-sm text-gray-500",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("span",{children:["Lat: ",parseFloat(e.latitude).toFixed(4)]}),(0,r.jsxs)("span",{children:["Lng: ",parseFloat(e.longitude).toFixed(4)]})]})})]},e.id))})})]})})})}function d(){return(0,r.jsx)(o.A,{requiredRole:"proprietaire",children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-tr from-blue-100 via-white to-blue-200",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin h-10 w-10 text-blue-600 mb-4",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),(0,r.jsx)("span",{className:"text-gray-700",children:"Chargement..."})]})}),children:(0,r.jsx)(c,{})})})}},7172:(e,t,s)=>{Promise.resolve().then(s.bind(s,5983))},8508:(e,t,s)=>{"use strict";s.d(t,{J3:()=>o,Lx:()=>a,iD:()=>n,ri:()=>c,ve:()=>i,wR:()=>l});let r={getItem:e=>localStorage.getItem(e),setItem:(e,t)=>{localStorage.setItem(e,t)},removeItem:e=>{localStorage.removeItem(e)}};async function a(e,t){let s=await fetch("http://localhost:8000/api/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!s.ok){let e="Identifiants invalides";try{let t=await s.json();e=t.detail||Object.values(t).join(" ")}catch(e){}throw Error(e)}let a=await s.json();r.setItem("access_token",a.access),r.setItem("refresh_token",a.refresh);let n=null;try{(n=JSON.parse(atob(a.access.split(".")[1])))&&n.username&&r.setItem("username",n.username),n&&n.first_name&&r.setItem("first_name",n.first_name)}catch(e){}return n}function n(){return r.getItem("access_token")}function i(){return r.getItem("refresh_token")}function o(){return r.getItem("first_name")||r.getItem("username")||""}function l(){return!!n()}function c(){r.removeItem("access_token"),r.removeItem("refresh_token"),r.removeItem("username"),r.removeItem("first_name")}},9053:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(5155),a=s(2115),n=s(5695),i=s(8508);function o(e){let{children:t,requiredRole:s}=e,o=(0,n.useRouter)(),[l,c]=(0,a.useState)(null);return((0,a.useEffect)(()=>{if(!(0,i.wR)())return void o.replace("/login");if(s){let e=(0,i.iD)(),t=e?function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}}(e):null;if(!t||t.role!==s)return void o.replace("/dashboard")}c(!0)},[o,s]),null===l)?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-tr from-blue-100 via-white to-blue-200",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin h-10 w-10 text-blue-600 mb-4",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),(0,r.jsx)("span",{className:"text-gray-700",children:"V\xe9rification des permissions..."})]})}):(0,r.jsx)(r.Fragment,{children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(7172)),_N_E=e.O()}]);